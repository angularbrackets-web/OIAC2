---
import oiacLogoDark from "../../assets/OIAC.Logo.Dark.png";
import oiacLogoLight from "../../assets/OIAC.Logo.Light.png";
import { Menu, X } from "@lucide/astro";

interface Props {
  variant: "a" | "b";
}

const { variant } = Astro.props;

const navItems = [
  { label: "Home", href: "/" },
  { label: "About", href: "/aboutus" },
  { label: "Prayer Times", href: "/prayertimes" },
  { label: "Programs", href: "/programs" },
  { label: "Events", href: "/events" },
  { label: "New Centre", href: "/newcentre", highlight: true },
  { label: "Contact", href: "/contactus" },
];

const isTransparent = variant === "b";
---

<nav
  id="proposal-nav"
  class:list={[
    "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
    isTransparent ? "bg-transparent" : "bg-warmWhite shadow-sm",
  ]}
  data-variant={variant}
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 md:h-20">
      <!-- Logo -->
      <a href="/" class="flex-shrink-0">
        {isTransparent ? (
          <img
            id="nav-logo"
            src={oiacLogoLight.src}
            alt="OIAC Logo"
            class="h-12 md:h-14 w-auto transition-opacity duration-300"
            data-light-src={oiacLogoLight.src}
            data-dark-src={oiacLogoDark.src}
          />
        ) : (
          <img
            src={oiacLogoDark.src}
            alt="OIAC Logo"
            class="h-12 md:h-14 w-auto"
          />
        )}
      </a>

      <!-- Desktop Links -->
      <div class="hidden lg:flex items-center gap-6 xl:gap-8">
        {navItems.map(item => (
          <a
            href={item.href}
            class:list={[
              "nav-link font-medium text-sm tracking-wide transition-colors duration-200",
              isTransparent ? "text-white hover:text-lightWood" : "text-deepTeal hover:text-terracottaRed",
              item.highlight && "bg-sageGreen/20 px-3 py-1 rounded-full",
            ]}
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- Right side: Donate + Hamburger -->
      <div class="flex items-center gap-3">
        <!-- Donate CTA (desktop) -->
        <a
          href="/donate"
          class="hidden lg:inline-flex bg-terracottaRed hover:bg-terracottaRed-darker text-white font-semibold px-6 py-2.5 rounded-lg transition-colors duration-200 text-sm"
        >
          Donate
        </a>

        <!-- Mobile Hamburger -->
        <button
          id="proposal-nav-toggle"
          class:list={[
            "lg:hidden p-2 rounded-lg transition-colors",
            isTransparent ? "hover:bg-white/10 text-white" : "hover:bg-softBeige text-deepTeal",
          ]}
          aria-label="Open navigation menu"
          aria-expanded="false"
        >
          <Menu class="w-6 h-6" />
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- Mobile Drawer Overlay -->
<div
  id="proposal-nav-overlay"
  class="fixed inset-0 bg-black/50 z-40 hidden opacity-0 transition-opacity duration-300"
  aria-hidden="true"
></div>

<!-- Mobile Drawer -->
<div
  id="proposal-nav-drawer"
  class="fixed inset-y-0 right-0 w-80 max-w-[85vw] bg-warmWhite z-50 transform translate-x-full transition-transform duration-300 ease-in-out shadow-2xl"
  role="dialog"
  aria-modal="true"
  aria-label="Navigation menu"
>
  <div class="flex flex-col h-full">
    <!-- Drawer Header -->
    <div class="flex items-center justify-between p-4 border-b border-softBeige">
      <img src={oiacLogoDark.src} alt="OIAC Logo" class="h-10 w-auto" />
      <button
        id="proposal-nav-close"
        class="p-2 rounded-lg hover:bg-softBeige transition-colors"
        aria-label="Close navigation menu"
      >
        <X class="w-6 h-6 text-deepTeal" />
      </button>
    </div>

    <!-- Drawer Links -->
    <nav class="flex-1 overflow-y-auto py-4">
      {navItems.map(item => (
        <a
          href={item.href}
          class="block px-6 py-3.5 text-deepTeal hover:bg-softBeige-lighter hover:text-terracottaRed font-medium text-base transition-colors border-b border-softBeige-lighter"
        >
          {item.label}
        </a>
      ))}
    </nav>

    <!-- Drawer Footer -->
    <div class="p-4 border-t border-softBeige">
      <a
        href="/donate"
        class="block bg-terracottaRed hover:bg-terracottaRed-darker text-white font-semibold text-center py-3.5 rounded-lg transition-colors text-base"
      >
        Donate
      </a>
    </div>
  </div>
</div>

<!-- Spacer for solid nav (variant A only) -->
{!isTransparent && <div class="h-16 md:h-20"></div>}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const nav = document.getElementById("proposal-nav");
    const toggle = document.getElementById("proposal-nav-toggle");
    const drawer = document.getElementById("proposal-nav-drawer");
    const overlay = document.getElementById("proposal-nav-overlay");
    const closeBtn = document.getElementById("proposal-nav-close");
    const logo = document.getElementById("nav-logo") as HTMLImageElement | null;
    const variant = nav?.dataset.variant;

    // --- Mobile Drawer ---
    function openDrawer() {
      drawer?.classList.remove("translate-x-full");
      overlay?.classList.remove("hidden");
      requestAnimationFrame(() => {
        overlay?.classList.remove("opacity-0");
        overlay?.classList.add("opacity-100");
      });
      toggle?.setAttribute("aria-expanded", "true");
      document.body.style.overflow = "hidden";
    }

    function closeDrawer() {
      drawer?.classList.add("translate-x-full");
      overlay?.classList.remove("opacity-100");
      overlay?.classList.add("opacity-0");
      setTimeout(() => overlay?.classList.add("hidden"), 300);
      toggle?.setAttribute("aria-expanded", "false");
      document.body.style.overflow = "";
    }

    toggle?.addEventListener("click", openDrawer);
    closeBtn?.addEventListener("click", closeDrawer);
    overlay?.addEventListener("click", closeDrawer);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeDrawer();
    });

    // --- Variant B: Transparent â†’ Solid on scroll ---
    if (variant === "b" && nav) {
      const links = nav.querySelectorAll(".nav-link");
      const hamburger = toggle;

      function updateNav() {
        if (!nav) return;
        const scrolled = window.scrollY > 80;
        if (scrolled) {
          nav.classList.add("bg-warmWhite/95", "backdrop-blur-md", "shadow-sm");
          nav.classList.remove("bg-transparent");
          links.forEach((l) => {
            l.classList.remove("text-white", "hover:text-lightWood");
            l.classList.add("text-deepTeal", "hover:text-terracottaRed");
          });
          if (hamburger) {
            hamburger.classList.remove("text-white", "hover:bg-white/10");
            hamburger.classList.add("text-deepTeal", "hover:bg-softBeige");
          }
          if (logo) logo.src = logo.dataset.darkSrc || "";
        } else {
          nav.classList.remove("bg-warmWhite/95", "backdrop-blur-md", "shadow-sm");
          nav.classList.add("bg-transparent");
          links.forEach((l) => {
            l.classList.add("text-white", "hover:text-lightWood");
            l.classList.remove("text-deepTeal", "hover:text-terracottaRed");
          });
          if (hamburger) {
            hamburger.classList.add("text-white", "hover:bg-white/10");
            hamburger.classList.remove("text-deepTeal", "hover:bg-softBeige");
          }
          if (logo) logo.src = logo.dataset.lightSrc || "";
        }
      }

      window.addEventListener("scroll", updateNav, { passive: true });
      updateNav(); // Initial state
    }
  });
</script>
