---
import { Play, Image, Building2, Briefcase, Users, Clock, BookOpen, FolderOpen, MessageSquare, ExternalLink, LogOut, LayoutDashboard, Megaphone, PanelTop, LayoutGrid } from '@lucide/astro';

interface Props {
  currentPage: string;
}
const { currentPage } = Astro.props;

const navGroups = [
  {
    label: 'Content',
    items: [
      { id: 'slideshow', label: 'Slideshow', href: '/admin/slideshow', icon: Play },
      { id: 'posters', label: 'Posters', href: '/admin/posters', icon: Image },
      { id: 'newcentre-updates', label: 'New Centre Updates', href: '/admin/newcentre-updates', icon: Building2 },
      { id: 'announcements', label: 'Announcements', href: '/admin/announcements', icon: Megaphone },
      { id: 'popups', label: 'Popups', href: '/admin/popups', icon: PanelTop },
      { id: 'featured-posters', label: 'Featured Posters', href: '/admin/featured-posters', icon: LayoutGrid },
    ],
  },
  {
    label: 'Management',
    items: [
      { id: 'jobs', label: 'Jobs', href: '/admin/jobs', icon: Briefcase },
      { id: 'staff', label: 'Staff', href: '/admin/staff', icon: Users },
    ],
  },
  {
    label: 'Prayer',
    items: [
      { id: 'prayer-times', label: 'Prayer Times', href: '/admin/prayer-times', icon: Clock },
      { id: 'jummah-times', label: 'Jummah Times', href: '/admin/jummah-times', icon: BookOpen },
    ],
  },
  {
    label: 'System',
    items: [
      { id: 'media', label: 'Media Library', href: '/admin/media', icon: FolderOpen },
      { id: 'feedback', label: 'Feedback', href: '/admin/feedback', icon: MessageSquare },
    ],
  },
];
---

<aside
  id="admin-sidebar"
  class="fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 flex flex-col transform -translate-x-full lg:translate-x-0 transition-transform duration-200 ease-in-out"
>
  <!-- Logo -->
  <div class="flex items-center gap-3 px-6 h-16 border-b border-gray-200 shrink-0">
    <a href="/admin" class="flex items-center gap-3 text-gray-900 no-underline">
      <LayoutDashboard size={22} class="text-blue-600" />
      <span class="text-lg font-bold tracking-tight">OIAC Admin</span>
    </a>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto py-4 px-3">
    {navGroups.map((group) => (
      <div class="mb-6">
        <p class="px-3 mb-2 text-xs font-semibold uppercase tracking-wider text-gray-400">
          {group.label}
        </p>
        <ul class="space-y-0.5">
          {group.items.map((item) => {
            const Icon = item.icon;
            const active = currentPage === item.id;
            return (
              <li>
                <a
                  href={item.href}
                  class:list={[
                    'flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-colors no-underline',
                    active
                      ? 'bg-blue-50 text-blue-700'
                      : 'text-gray-700 hover:bg-gray-50',
                  ]}
                >
                  <Icon size={20} class={active ? 'text-blue-600' : 'text-gray-400'} />
                  <span>{item.label}</span>
                </a>
              </li>
            );
          })}
        </ul>
      </div>
    ))}
  </nav>

  <!-- Bottom actions -->
  <div class="border-t border-gray-200 px-3 py-3 space-y-0.5 shrink-0">
    <a
      href="/"
      target="_blank"
      class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors no-underline"
    >
      <ExternalLink size={20} class="text-gray-400" />
      <span>View Site</span>
    </a>
    <a
      href="/api/admin/logout"
      class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors no-underline"
    >
      <LogOut size={20} class="text-gray-400" />
      <span>Sign Out</span>
    </a>
  </div>
</aside>

<!-- Mobile backdrop -->
<div
  id="sidebar-backdrop"
  class="fixed inset-0 z-40 bg-black/40 hidden lg:hidden"
></div>

<script is:inline>
(function() {
  const sidebar = document.getElementById('admin-sidebar');
  const backdrop = document.getElementById('sidebar-backdrop');
  const openBtn = document.getElementById('sidebar-open-btn');

  function openSidebar() {
    sidebar?.classList.remove('-translate-x-full');
    sidebar?.classList.add('translate-x-0');
    backdrop?.classList.remove('hidden');
  }

  function closeSidebar() {
    sidebar?.classList.add('-translate-x-full');
    sidebar?.classList.remove('translate-x-0');
    backdrop?.classList.add('hidden');
  }

  openBtn?.addEventListener('click', openSidebar);
  backdrop?.addEventListener('click', closeSidebar);

  // Expose for external use
  window.openAdminSidebar = openSidebar;
  window.closeAdminSidebar = closeSidebar;
})();
</script>
