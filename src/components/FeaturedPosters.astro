---
import { getFeaturedPosters, getSetting } from '../lib/db';

const sectionVisible = await getSetting('featured_posters_visible');
const posters = sectionVisible !== false ? await getFeaturedPosters() : [];
const showSection = sectionVisible !== false && posters.length > 0;
---

{showSection && (
<section class="px-4 py-4 md:px-8 mx-auto">
  <div class="container">
    <div class={`
      grid gap-4
      ${posters.length === 1 ? 'grid-cols-1 max-w-md mx-auto' : ''}
      ${posters.length === 2 ? 'grid-cols-1 sm:grid-cols-2 max-w-3xl mx-auto' : ''}
      ${posters.length === 3 ? 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3' : ''}
      ${posters.length >= 4 ? 'grid-cols-2 sm:grid-cols-2 lg:grid-cols-4' : ''}
    `}>
      {posters.map((poster) => (
        <div class="group relative rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300 bg-white border border-gray-100">
          {poster.linkUrl ? (
            <a href={poster.linkUrl} target="_blank" rel="noopener noreferrer" class="block">
              <div class="relative aspect-[3/4] overflow-hidden">
                <img
                  src={poster.imageUrl}
                  alt={poster.title}
                  class="w-full h-full object-cover object-center group-hover:scale-[1.03] transition-transform duration-500"
                  loading="lazy"
                />
              </div>
            </a>
          ) : (
            <div class="relative aspect-[3/4] overflow-hidden">
              <img
                src={poster.imageUrl}
                alt={poster.title}
                class="w-full h-full object-cover object-center"
                loading="lazy"
              />
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</section>
)}
